From 0e6e55a920b045cec6641880d4fece402e9d5808 Mon Sep 17 00:00:00 2001
From: gridtime <workispleasure@pleasureiswork.net>
Date: Tue, 6 Feb 2024 11:48:03 +0100
Subject: [PATCH 1/3] adjusts html saniziter settings to match expected types

---
 src/backend/html_markdown.py | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/src/backend/html_markdown.py b/src/backend/html_markdown.py
index a159ea6f..4f55b076 100644
--- a/src/backend/html_markdown.py
+++ b/src/backend/html_markdown.py
@@ -268,11 +268,11 @@ class HTMLProcessor:
         return {
             "tags": inline_tags if inline else all_tags,
             "attributes": inlines_attributes if inline else attributes,
-            "empty": {} if inline else {"hr", "br", "img"},
-            "separate": {"a"} if inline else {
+            "empty": set() if inline else set({"hr", "br", "img"}),
+            "separate": set({"a"}) if inline else set({
                 "a", "p", "li", "table", "tr", "th", "td", "br", "hr", "img",
-            },
-            "whitespace": {},
+            }),
+            "whitespace": set(),
             "keep_typographic_whitespace": True,
             "add_nofollow": False,
             "autolink": {
-- 
GitLab


From 456525aa25e91b5286ea78ac0d088d7125e57d71 Mon Sep 17 00:00:00 2001
From: gridtime <workispleasure@pleasureiswork.net>
Date: Tue, 6 Feb 2024 11:49:02 +0100
Subject: [PATCH 2/3] raises allowed html_sanitizer version in requirements.txt

---
 requirements.txt | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/requirements.txt b/requirements.txt
index 3fd5ff01..13f1b5ed 100644
--- a/requirements.txt
+++ b/requirements.txt
@@ -4,7 +4,7 @@ appdirs           >= 1.4.4,  < 2
 cairosvg          >= 2.4.2,  < 3
 emoji             >= 2.0,    < 3.0
 filetype          >= 1.0.7,  < 2
-html_sanitizer    >= 1.9.1,  < 2
+html_sanitizer    >= 1.9.1,  < 3
 lxml              >= 4.5.1,  < 5
 mistune           >= 2.0.0,  < 3.0
 pymediainfo       >= 4.2.1,  < 5
-- 
GitLab


From 8521182a094d89214aaf7be989088671d96caa82 Mon Sep 17 00:00:00 2001
From: gridtime <workispleasure@pleasureiswork.net>
Date: Tue, 6 Feb 2024 12:12:56 +0100
Subject: [PATCH 3/3] removes unneccessary set casts

---
 src/backend/html_markdown.py | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/src/backend/html_markdown.py b/src/backend/html_markdown.py
index 4f55b076..19baa469 100644
--- a/src/backend/html_markdown.py
+++ b/src/backend/html_markdown.py
@@ -268,10 +268,10 @@ class HTMLProcessor:
         return {
             "tags": inline_tags if inline else all_tags,
             "attributes": inlines_attributes if inline else attributes,
-            "empty": set() if inline else set({"hr", "br", "img"}),
-            "separate": set({"a"}) if inline else set({
+            "empty": set() if inline else {"hr", "br", "img"},
+            "separate": {"a"} if inline else {
                 "a", "p", "li", "table", "tr", "th", "td", "br", "hr", "img",
-            }),
+            },
             "whitespace": set(),
             "keep_typographic_whitespace": True,
             "add_nofollow": False,
-- 
GitLab


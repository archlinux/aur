From e1d1dc63524340c59db3628a18cac6ee30f27616 Mon Sep 17 00:00:00 2001
From: Julianne H <julianne.hervier@qonfucius.team>
Date: Fri, 3 Mar 2023 15:24:02 +0100
Subject: [PATCH] makepkg: Use system gtest

---
 CMakeLists.txt | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index b17655c..f4e404b 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -88,16 +88,20 @@ endif()
 option(PHMAP_BUILD_TESTS    "Whether or not to build the tests"    ${PHMAP_MASTER_PROJECT})
 option(PHMAP_BUILD_EXAMPLES "Whether or not to build the examples" ${PHMAP_MASTER_PROJECT})
 
+option(PHMAP_USE_SYSTEM_GTEST "Use system gtest" ON)
+
 if(MSVC)
     set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /bigobj")
 endif()
 
 if (PHMAP_BUILD_TESTS)
+    include_directories(${PROJECT_SOURCE_DIR})
 
-    if (NOT PHMAP_GTEST_LIBS)
+    if (PHMAP_USE_SYSTEM_GTEST)
+        find_package(GTest REQUIRED)
+        set(PHMAP_GTEST_LIBS GTest::gtest GTest::gtest_main GTest::gmock)
+    else ()
         include(cmake/DownloadGTest.cmake)
-        include_directories(${PROJECT_SOURCE_DIR})
-    
         check_target(gtest)
         check_target(gtest_main)
         check_target(gmock)
@@ -199,4 +203,3 @@ if (PHMAP_BUILD_EXAMPLES)
     target_link_libraries(ex_knucleotide Threads::Threads)
     target_link_libraries(ex_bench Threads::Threads)
 endif()
-
-- 
2.39.2


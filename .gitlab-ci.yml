image: manjarolinux/base:latest

before_script:
  - pamac checkupdates -a && pamac install --no-confirm sed jq pacman
  - useradd -m builduser
  - passwd -d builduser
  - printf 'builduser ALL=(ALL) ALL\n' | tee -a /etc/sudoers
  - su -c "cd ${CI_PROJECT_DIR} && makepkg" - builduser

stages:
  - find_release
  - test
  - release

find_release_job:
  stage: find_release
  script: ./find_release.sh
  artifacts:
    paths:
      - PKGBUILD
  only:
    - schedules

test_job:
  stage: test
  script: ./test
  dependencies:
    - find_release_job
  only:
    - schedules

release_job:
  stage: release
  script: ./release
  dependencies:
    - find_release_job
  only:
    - schedules

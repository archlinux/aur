post_install() {
	cd /usr/share/webapps/gakuen

	bash setup_prod.sh

	# Set permissions
	chown http:http . db.sqlite3
	chown http:http -R static myenv

	secret=`python -c 'import random; result = "".join([random.choice("abcdefghijklmnopqrstuvwxyz0123456789!@#$%^*(-_=+)") for i in range(50)]); print(result)'`
	sed -i "s/^SECRET_KEY = .*$/SECRET_KEY = '$secret'/" gakuen/settings.py
	sed -i "s/^DEBUG = .*$/DEBUG = False/" gakuen/settings.py

	cp gakuen/settings.py{,.prod}

	echo "==>"
	echo "==>"
	echo "==> Check /usr/share/webapps/gakuen/misc/apache.conf"
	echo "==>"
	echo "==>"
}

post_upgrade() {
	cd /usr/share/webapps/gakuen

	bash update_prod.sh

	cp gakuen/settings.py{,.old}
	cp gakuen/settings.py{.prod,}

	sudo systemctl restart httpd
}


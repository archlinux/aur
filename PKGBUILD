# Maintainer: Alexandru M. Stan <amstan@chromium.org>
# Python package author: Pigweed Authors <pigweed-developers@googlegroups.com>
# PKGBUILD originally generated by pipman
pkgname=python-pigweed
pkgver=0.0.15
pkgrel=1
pkgdesc="Pigweed Python modules"
arch=(any)
url="https://pigweed.dev"
license=("Apache")
makedepends=("python" "python-pip")
depends=("python-jinja"
        "python-pyyaml"
        "python-pygments"
        "python-coloredlogs" # AUR
        "python-coverage"
        "python-cryptography"
        "python-google-cloud-storage" # AUR
        "ipython"
        "python-mypy-protobuf" # AUR
        "python-parameterized"
        "python-prompt_toolkit"
        "python-protobuf"
        "ptpython" # AUR
        "python-pyelftools"
        "python-pyperclip"
        "python-pyserial"
        "python-six"
        "python-sphinx"
        "python-types-pyyaml" # AUR
        "python-watchdog"
        "python-wheel"
        "yapf")
optdepends=("python-httpwatcher: extra plugin for pw_watch"

            # Some unavailable deps in Arch, but we don't seem to need them?
            # Let's mark them as optional as well:
            "python-pygments-style-dracula"
            "python-pygments-style-tomorrow"
            "python-scan-build"
            "python-sphinx-rtd-theme"
            "python-sphinxcontrib-mermaid"
            "python-types-protobuf"
            "python-types-pygments"
            "python-types-six")

build() {
  pip install --no-deps --target="pigweed" pigweed==${pkgver}
}

package() {
  sitepackages=$(python -c "import site; print(site.getsitepackages()[0])")
  mkdir -p $pkgdir/"$sitepackages"
  cp -r $srcdir/pigweed/* $pkgdir/"$sitepackages"
}

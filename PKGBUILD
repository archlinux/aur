# Generated by debtap
# Maintainer: Jan Kohnert <bughunter@jan-kohnert.de>
# Contributor: Matthew Sexton <wsdmatty@gmail.com>
# Contributor: Lorenz Wellmer
pkgname=clockify-desktop
pkgver=2.1.8
pkgrel=1
pkgdesc="Truly free time tracker for teams, Desktop App"
arch=("x86_64")
url="https://clockify.me"
license=("custom")
depends=("alsa-lib" "at-spi2-core" "cairo" "dbus" "expat" "gcc-libs" "glib2"
         "glibc" "gtk3" "hicolor-icon-theme" "java-runtime" "libcups" "libdrm"
         "libx11" "libxcb" "libxcomposite" "libxdamage" "libxext" "libxfixes"
         "libxkbcommon" "libxrandr" "mesa" "nspr" "nss" "pango")
source=("$pkgname-$pkgver.deb::https://clockify.me/downloads/Clockify_Setup_x64.deb")
sha512sums=("112e431100b6809f5077e9ff64092b73e76777fe206afc8a088f0415368138ae16f64d61b3589497d561ea94c1f9ee99a61dd368ee8137cc054a086be654288a")

package() {
    # Extract package data
    tar xf data.tar.xz -C "${pkgdir}"
    
    # install license
    install -D -m644 "${pkgdir}/opt/Clockify/LICENSES.chromium.html" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
    
    # Fix permission issues
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/assets.d.ts"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/assets.js"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/audio/pomodoro-notification.ogg"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/entitlements.mac.plist"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/icon.icns"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/icons/64x64.ico"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/icons/blue.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/icons/white.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/\$-selected.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/\$.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/1024x10240.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/32x32.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/64x64.ico"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/64x64.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/approved.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/arrow-dark-mode-up.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/arrow-dark-mode.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/arrow-light-mode-up.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/arrow-light-mode.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/automatic-hover.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/automatic.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/autotracker-active.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/autotracker-inactive.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/billable.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/calendar.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/checked.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/circle_1.svg"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/circle_2.svg"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/clockify.ico"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/clockify_illustration.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/clockify_logo.svg"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/clockify_logo_dark.svg"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/clockify_logo_selfhosted.svg"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/closeX.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/create.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/edit-unsynced-hover.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/edit-unsynced.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/filter-arrow-down.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/filter-arrow-right.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/gear.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/icon-cal.svg"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/icon-check-circle.svg"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/icon-chevron-left.svg"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/icon-chevron-right.svg"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/icon-lock.svg"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/icon-plus-circle.svg"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/icon-settings.svg"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/icon.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/loading.gif"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/lock-indicator.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/logo-128.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/logo-16-gray.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/logo-16.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/logo-48.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/logo.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/logout-hover.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/logout-normal.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/logout.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/manual-hover.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/manual.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/menu-dots-vertical.svg"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/menu-hover.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/menu.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/out-link.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/play-hover.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/play-normal.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/reload-hover.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/reload-normal.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/settings-hover.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/settings-normal.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/settings.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/sync-hover.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/sync.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/tag.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/time-hover.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/time.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/workspace-checked.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/images/x.png"
    chmod a-w "${pkgdir}/opt/Clockify/resources/assets/no-user-image.png"
    
    # Fix hardlinks
    rm "${pkgdir}/usr/share/icons/hicolor/32x32/apps/clockify.png"
    ln -s /opt/Clockify/resources/assets/icons/32x32.png "${pkgdir}/usr/share/icons/hicolor/32x32/apps/clockify.png"
    rm "${pkgdir}/usr/share/icons/hicolor/64x64/apps/clockify.png"
    ln -s /opt/Clockify/resources/assets/icons/64x64.png "${pkgdir}/usr/share/icons/hicolor/64x64/apps/clockify.png"
    rm "${pkgdir}/usr/share/icons/hicolor/1024x1024/apps/clockify.png"
    ln -s /opt/Clockify/resources/assets/icons/1024x1024.png "${pkgdir}/usr/share/icons/hicolor/1024x1024/apps/clockify.png"
    
    # Remove forgotten temporary build build pkgdir
    rm -r "${pkgdir}/opt/Clockify/resources/app.asar.unpacked/node_modules/active-win/build-tmp-napi-v6"
    rm -r "${pkgdir}/opt/Clockify/resources/app.asar.unpacked/node_modules/active-win/lib/binding/napi-6-linux-glibc-x64"
    rm -r "${pkgdir}/opt/Clockify/resources/app.asar.unpacked/node_modules/active-win/build"
    
    # generate link in PATH
    install -dm755 "${pkgdir}/usr/bin"
    ln -s "/opt/Clockify/clockify" "${pkgdir}/usr/bin/clockify"
    
}

post_install() {
	#set up service files
	case "`readlink /usr/bin/init`" in
		(*systemd)
			cat > /lib/systemd/system/alsabeep.service <<EOF
[Unit]
Description=Alsa based beep replacement for systems without a PC Speaker

[Service]
ExecStart=/usr/bin/alsabeep-helper start
ExecStop=/usr/bin/alsabeep-helper stop

[Install]
WantedBy=default.target
EOF
			;;
		(*runit*)
			mkdir /etc/runit/sv/alsabeep
			cat >/etc/runit/sv/alsabeep/run <<EOF
#!/usr/bin/sh
exec /usr/bin/alsabeep-helper start
EOF
			cat >/etc/runit/sv/alsabeep/finish <<EOF
#!/usr/bin/sh
exec /usr/bin/alsabeep-helper stop
EOF
			chmod a+x /etc/runit/sv/alsabeep/*
			;;
	esac

	cat<<EOF

configure using /etc/alsabeep-helper.conf

Unload and load kernel modules:

  rmmod pcspkr
  rmmod fancybeep
  modprobe alsabeep

EOF
}

post_upgrade() {
  post_install
}

post_remove() {
	(
	killall alsabeep-daemon || true
	modprobe -r alsabeep || true
	rm -rf /lib/systemd/system/alsabeep.service /etc/runit/sv/alsabeep || true
	) 2>/dev/null
}

#!/bin/bash
export WINEPREFIX="$HOME/.local/share/wineprefixes/crowbar"
export WINEDEBUG=-all

declare -a args

for arg; do
  if [[ "${arg:0:1}" = "-" ]]; then
    args+=("${arg/#-//}")
  else
    args+=("$(winepath -w "$arg")")
  fi
done

wine /usr/share/crowbar/crowbar.exe "${args[@]}"
EXIT=$?

if [[ $EXIT -ne 0 ]]; then
  echo "Error: Crowbar failed to launch!"
  echo -e "If Crowbar didn't start, you should try deleting your Crowbar Wine prefix and restart:"
  echo "rm -dr ~/.local/share/wineprefixes/crowbar"
  exit $EXIT
fi

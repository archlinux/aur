From d2c95fcb95e2227ad32531960bfe19b002627c97 Mon Sep 17 00:00:00 2001
From: Evangelos Paterakis <evan@geopjr.dev>
Date: Thu, 17 Aug 2023 16:55:45 +0300
Subject: [PATCH] fix: Vala 0.56.11 vapi change  & GTK 4.12 deprication

---
 meson.build              |  8 ++++++++
 src/Widgets/VoteBox.vala | 12 +++++++++++-
 2 files changed, 19 insertions(+), 1 deletion(-)

diff --git a/meson.build b/meson.build
index b780d01d..dc8512a9 100644
--- a/meson.build
+++ b/meson.build
@@ -79,6 +79,14 @@ if libgtk_dep.version().version_compare('>=4.10.0')
   add_project_arguments(['--define=GTK_4_10'], language: 'vala')
 endif
 
+if libgtk_dep.version().version_compare('>=4.12.0')
+  add_project_arguments(['--define=GTK_4_12'], language: 'vala')
+endif
+
+if meson.get_compiler('vala').version().version_compare('>=0.56.11')
+  add_project_arguments(['--define=VALAC_05611'], language: 'vala')
+endif
+
 if libspelling.found ()
   add_project_arguments(['--define=LIBSPELLING'], language: 'vala')
 endif
diff --git a/src/Widgets/VoteBox.vala b/src/Widgets/VoteBox.vala
index 33cd697f..5120cf98 100644
--- a/src/Widgets/VoteBox.vala
+++ b/src/Widgets/VoteBox.vala
@@ -72,7 +72,17 @@ public class Tuba.Widgets.VoteBox: Box {
                 var percentage = poll.votes_count > 0 ? ((double)p.votes_count / poll.votes_count) * 100 : 0.0;
 
                 var provider = new Gtk.CssProvider ();
-                provider.load_from_data (generate_css_style ((int) percentage).data);
+
+                #if GTK_4_12
+                    provider.load_from_string (generate_css_style ((int) percentage));
+                #else
+                    #if VALAC_05611
+                        provider.load_from_data (generate_css_style ((int) percentage), -1);
+                    #else
+                        provider.load_from_data (generate_css_style ((int) percentage).data);
+                    #endif
+                #endif
+
                 row.get_style_context ().add_provider (provider, Gtk.STYLE_PROVIDER_PRIORITY_APPLICATION);
                 row.add_css_class (@"ttl-poll-$((int) percentage)");
 

post_install() {
    cscli capi register --error
    cscli machines add --auto --force --error
    cscli hub update
}

pre_upgrade() {
    cscli config backup /var/lib/crowdsec/backup
}

post_upgrade() {
    if [[ -d /var/lib/crowdsec/backup ]]; then
        cscli config restore /var/lib/crowdsec/backup && rm -rf /var/lib/crowdsec/backup
    fi
    cscli hub update
    cscli hub upgrade
}

pre_remove() {
    cscli dashboard remove --force --yes --error || true
}

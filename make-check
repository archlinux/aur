#!/bin/bash

# A convenience script for the package creator.
# This file is not run on package installation.

set -euo pipefail
shopt -s failglob

# Reset customised values to defaults
PACMAN=
PATH=/usr/bin:$PATH

# Compressing is slow when building many times
export PKGEXT=.pkg.tar

pkgdir=${0%%/*}  # dirname $0
cd -P -- "$pkgdir" || exit 1  # Allow to be called from any directory

if [[ -d src ]]; then
  makepkg -ef "$@"
else
  makepkg -f "$@"
fi

namcap PKGBUILD
namcap ./*.pkg.*

makepkg --printsrcinfo >| .SRCINFO && echo "Updated .SRCINFO" >&2

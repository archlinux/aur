diff --unified --recursive --text mesa/src/gallium/auxiliary/gallivm/lp_bld_misc.cpp mesa.new1/src/gallium/auxiliary/gallivm/lp_bld_misc.cpp
--- mesa/src/gallium/auxiliary/gallivm/lp_bld_misc.cpp	2023-09-19 14:11:23.739532226 +0200
+++ mesa.new1/src/gallium/auxiliary/gallivm/lp_bld_misc.cpp	2023-09-19 15:17:40.952081411 +0200
@@ -363,10 +363,17 @@
    options.StackAlignmentOverride = 4;
 #endif
 
+#if LLVM_VERSION_MAJOR >= 18
+   builder.setEngineKind(EngineKind::JIT)
+          .setErrorStr(&Error)
+          .setTargetOptions(options)
+          .setOptLevel((CodeGenOptLevel)OptLevel);
+#else
    builder.setEngineKind(EngineKind::JIT)
           .setErrorStr(&Error)
           .setTargetOptions(options)
           .setOptLevel((CodeGenOpt::Level)OptLevel);
+#endif
 
 #if DETECT_OS_WINDOWS
     /*

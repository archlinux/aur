#!/usr/bin/env sh

debug() {
    if [ -n DEBUG ]; then
        >&2 echo $*
    fi
}

libs=$(lsof -n +c 0 2> /dev/null | grep 'DEL.*lib' | awk '1 { print $1 ": " $NF }' | sort -u)
if [[ -n $libs ]]; then
    debug "$libs"
    debug "libs need reload"
    exit 0
fi

if [ ! -d "/lib/modules/$(uname -r)" ]; then
    debug "kernel need reload"
    exit 0
fi

exit 1
